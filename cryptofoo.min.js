/*
 * cryptofoo
 * a good compromise between speed and validity
 *
 * Copyright 2013, Simon Waldherr - http://simon.waldherr.eu/
 * Released under the MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Github:  https://github.com/simonwaldherr/cryptofoo/
 * Version: 0.1.0
 */

//based on code from http://blog.faultylabs.com/files/md5.js and http://www.sunsean.com/Whirlpool.js (both under public license)
/*jslint browser: true, bitwise: true, plusplus: true, white: true */
/*globals ArrayBuffer, Uint8Array, Int8Array, Uint16Array, Int16Array, Uint32Array, Int32Array, Float32Array, Float64Array */

var cryptofoo;cryptofoo={md5:function(l){var h,m;function n(r,s){return(r[s+3]<<24)|(r[s+2]<<16)|(r[s+1]<<8)|(r[s])}function o(v){var r=[],u,s,t;for(u=0;u<v.length;u++){if(v.charCodeAt(u)<=127){r.push(v.charCodeAt(u))}else{t=encodeURIComponent(v.charAt(u)).substr(1).split("%");for(s=0;s<t.length;s++){r.push(parseInt(t[s],16))}}}return r}function c(s){var r=(s>>>0).toString(16);return"00000000".substr(0,8-r.length)+r}function q(){var v,u,r,s;v="";u=0;r=0;for(s=3;s>=0;s--){r=arguments[s];u=(r&255);r=r>>>8;u=u<<8;u=u|(r&255);r=r>>>8;u=u<<8;u=u|(r&255);r=r>>>8;u=u<<8;u=u|r;v=v+c(u)}return v}function k(t){var r=[],s;for(s=0;s<t.length;s++){r[s]=t[s]}return r}function a(t){var r=[],s;for(s=0;s<t.length;s++){r=r.concat(o(t[s]))}return r}function p(s){var r=[],t;for(t=0;t<8;t++){r.push(s&255);s=s>>>8}return r}function j(s,r){return((s<<r)&4294967295)|(s>>>(32-r))}function i(r,t,s){return(r&t)|(~r&s)}function g(r,t,s){return(s&r)|(~s&t)}function e(r,t,s){return r^t^s}function d(r,t,s){return t^(r|~s)}h=null;m=null;if(typeof l==="string"){h=o(l)}else{if(l.constructor===Array){if(l.length===0){h=l}else{if(typeof l[0]==="string"){h=a(l)}else{if(typeof l[0]==="number"){h=l}else{m=typeof l[0]}}}}else{if(ArrayBuffer!==undefined){if(l instanceof ArrayBuffer){h=k(new Uint8Array(l))}else{if((l instanceof Uint8Array)||(l instanceof Int8Array)){h=k(l)}else{if((l instanceof Uint32Array)||(l instanceof Int32Array)||(l instanceof Uint16Array)||(l instanceof Int16Array)||(l instanceof Float32Array)||(l instanceof Float64Array)){h=k(new Uint8Array(l.buffer))}else{m=typeof l}}}}else{m=typeof l}}}if(m){return false}function b(s,r){return 4294967295&(s+r)}function f(){var s,v,t,C,A,y,w,D,B,z,x,r;s=h.length;h.push(128);v=h.length%64;if(v>56){for(t=0;t<(64-v);t++){h.push(0)}v=h.length%64}for(t=0;t<(56-v);t++){h.push(0)}h=h.concat(p(s*8));C=1732584193;A=4023233417;y=2562383102;w=271733878;D=0;B=0;z=0;x=0;function u(H,I,F,E){var G=x;x=z;z=B;B=b(B,j(b(D,b(H,b(I,F))),E));D=G}for(t=0;t<h.length/64;t++){D=C;B=A;z=y;x=w;r=t*64;u(i(B,z,x),3614090360,n(h,r),7);u(i(B,z,x),3905402710,n(h,r+4),12);u(i(B,z,x),606105819,n(h,r+8),17);u(i(B,z,x),3250441966,n(h,r+12),22);u(i(B,z,x),4118548399,n(h,r+16),7);u(i(B,z,x),1200080426,n(h,r+20),12);u(i(B,z,x),2821735955,n(h,r+24),17);u(i(B,z,x),4249261313,n(h,r+28),22);u(i(B,z,x),1770035416,n(h,r+32),7);u(i(B,z,x),2336552879,n(h,r+36),12);u(i(B,z,x),4294925233,n(h,r+40),17);u(i(B,z,x),2304563134,n(h,r+44),22);u(i(B,z,x),1804603682,n(h,r+48),7);u(i(B,z,x),4254626195,n(h,r+52),12);u(i(B,z,x),2792965006,n(h,r+56),17);u(i(B,z,x),1236535329,n(h,r+60),22);u(g(B,z,x),4129170786,n(h,r+4),5);u(g(B,z,x),3225465664,n(h,r+24),9);u(g(B,z,x),643717713,n(h,r+44),14);u(g(B,z,x),3921069994,n(h,r),20);u(g(B,z,x),3593408605,n(h,r+20),5);u(g(B,z,x),38016083,n(h,r+40),9);u(g(B,z,x),3634488961,n(h,r+60),14);u(g(B,z,x),3889429448,n(h,r+16),20);u(g(B,z,x),568446438,n(h,r+36),5);u(g(B,z,x),3275163606,n(h,r+56),9);u(g(B,z,x),4107603335,n(h,r+12),14);u(g(B,z,x),1163531501,n(h,r+32),20);u(g(B,z,x),2850285829,n(h,r+52),5);u(g(B,z,x),4243563512,n(h,r+8),9);u(g(B,z,x),1735328473,n(h,r+28),14);u(g(B,z,x),2368359562,n(h,r+48),20);u(e(B,z,x),4294588738,n(h,r+20),4);u(e(B,z,x),2272392833,n(h,r+32),11);u(e(B,z,x),1839030562,n(h,r+44),16);u(e(B,z,x),4259657740,n(h,r+56),23);u(e(B,z,x),2763975236,n(h,r+4),4);u(e(B,z,x),1272893353,n(h,r+16),11);u(e(B,z,x),4139469664,n(h,r+28),16);u(e(B,z,x),3200236656,n(h,r+40),23);u(e(B,z,x),681279174,n(h,r+52),4);u(e(B,z,x),3936430074,n(h,r),11);u(e(B,z,x),3572445317,n(h,r+12),16);u(e(B,z,x),76029189,n(h,r+24),23);u(e(B,z,x),3654602809,n(h,r+36),4);u(e(B,z,x),3873151461,n(h,r+48),11);u(e(B,z,x),530742520,n(h,r+60),16);u(e(B,z,x),3299628645,n(h,r+8),23);u(d(B,z,x),4096336452,n(h,r),6);u(d(B,z,x),1126891415,n(h,r+28),10);u(d(B,z,x),2878612391,n(h,r+56),15);u(d(B,z,x),4237533241,n(h,r+20),21);u(d(B,z,x),1700485571,n(h,r+48),6);u(d(B,z,x),2399980690,n(h,r+12),10);u(d(B,z,x),4293915773,n(h,r+40),15);u(d(B,z,x),2240044497,n(h,r+4),21);u(d(B,z,x),1873313359,n(h,r+32),6);u(d(B,z,x),4264355552,n(h,r+60),10);u(d(B,z,x),2734768916,n(h,r+24),15);u(d(B,z,x),1309151649,n(h,r+52),21);u(d(B,z,x),4149444226,n(h,r+16),6);u(d(B,z,x),3174756917,n(h,r+44),10);u(d(B,z,x),718787259,n(h,r+8),15);u(d(B,z,x),3951481745,n(h,r+36),21);C=b(C,D);A=b(A,B);y=b(y,z);w=b(w,x)}return q(w,y,A,C)}return f()},whirlpool:function(a){var E,j=10,z=[],A=[],o=0,k=0,e=[],p=[],l=[],n=[],h=[],w=[],y=[],G,m,s,q,D,v,B,g,f,d,b,H,F,u="\u1823\uc6E8\u87B8\u014F\u36A6\ud2F5\u796F\u9152\u60Bc\u9B8E\uA30c\u7B35\u1dE0\ud7c2\u2E4B\uFE57\u1577\u37E5\u9FF0\u4AdA\u58c9\u290A\uB1A0\u6B85\uBd5d\u10F4\ucB3E\u0567\uE427\u418B\uA77d\u95d8\uFBEE\u7c66\udd17\u479E\ucA2d\uBF07\uAd5A\u8333\u6302\uAA71\uc819\u49d9\uF2E3\u5B88\u9A26\u32B0\uE90F\ud580\uBEcd\u3448\uFF7A\u905F\u2068\u1AAE\uB454\u9322\u64F1\u7312\u4008\uc3Ec\udBA1\u8d3d\u9700\ucF2B\u7682\ud61B\uB5AF\u6A50\u45F3\u30EF\u3F55\uA2EA\u65BA\u2Fc0\udE1c\uFd4d\u9275\u068A\uB2E6\u0E1F\u62d4\uA896\uF9c5\u2559\u8472\u394c\u5E78\u388c\ud1A5\uE261\uB321\u9c1E\u43c7\uFc04\u5199\u6d0d\uFAdF\u7E24\u3BAB\ucE11\u8F4E\uB7EB\u3c81\u94F7\uB913\u2cd3\uE76E\uc403\u5644\u7FA9\u2ABB\uc153\udc0B\u9d6c\u3174\uF646\uAc89\u14E1\u163A\u6909\u70B6\ud0Ed\ucc42\u98A4\u285c\uF886";for(s=0;s<8;s++){w[s]=[]}for(q=0;q<256;q++){D=u.charCodeAt(q/2);g=((q&1)===0)?D>>>8:D&255;f=g<<1;if(f>=256){f^=285}d=f<<1;if(d>=256){d^=285}b=d^g;H=d<<1;if(H>=256){H^=285}F=H^g;w[0][q]=[0,0];w[0][q][0]=g<<24|g<<16|d<<8|g;w[0][q][1]=H<<24|b<<16|f<<8|F;for(s=1;s<8;s++){w[s][q]=[0,0];w[s][q][0]=(w[s-1][q][0]>>>8)|((w[s-1][q][1]<<24));w[s][q][1]=(w[s-1][q][1]>>>8)|((w[s-1][q][0]<<24))}}y[0]=[0,0];for(v=1;v<=j;v++){B=8*(v-1);y[v]=[0,0];y[v][0]=(w[0][B][0]&4278190080)^(w[1][B+1][0]&16711680)^(w[2][B+2][0]&65280)^(w[3][B+3][0]&255);y[v][1]=(w[4][B+4][1]&4278190080)^(w[5][B+5][1]&16711680)^(w[6][B+6][1]&65280)^(w[7][B+7][1]&255)}G=function(){var C,c,J,I,x;for(C=0,c=0;C<8;C++,c+=8){n[C]=[0,0];n[C][0]=((A[c]&255)<<24)^((A[c+1]&255)<<16)^((A[c+2]&255)<<8)^((A[c+3]&255));n[C][1]=((A[c+4]&255)<<24)^((A[c+5]&255)<<16)^((A[c+6]&255)<<8)^((A[c+7]&255))}for(C=0;C<8;C++){h[C]=[0,0];p[C]=[0,0];p[C][0]=e[C][0];p[C][1]=e[C][1];h[C][0]=n[C][0]^p[C][0];h[C][1]=n[C][1]^p[C][1]}for(J=1;J<=j;J++){for(C=0;C<8;C++){l[C]=[0,0];for(x=0,I=56,c=0;x<8;x++,I-=8,c=I<32?1:0){l[C][0]^=w[x][(p[(C-x)&7][c]>>>(I%32))&255][0];l[C][1]^=w[x][(p[(C-x)&7][c]>>>(I%32))&255][1]}}for(C=0;C<8;C++){p[C][0]=l[C][0];p[C][1]=l[C][1]}p[0][0]^=y[J][0];p[0][1]^=y[J][1];for(C=0;C<8;C++){l[C][0]=p[C][0];l[C][1]=p[C][1];for(x=0,I=56,c=0;x<8;x++,I-=8,c=I<32?1:0){l[C][0]^=w[x][(h[(C-x)&7][c]>>>(I%32))&255][0];l[C][1]^=w[x][(h[(C-x)&7][c]>>>(I%32))&255][1]}}for(C=0;C<8;C++){h[C][0]=l[C][0];h[C][1]=l[C][1]}}for(C=0;C<8;C++){e[C][0]^=h[C][0]^n[C][0];e[C][1]^=h[C][1]^n[C][1]}};E=function(c){return E.init().add(c).finalize()};E.version="3.0";E.init=function(){var c;for(c=0;c<32;c++){z[c]=0}o=k=0;A=[0];for(c=0;c<8;c++){e[c]=[0,0]}return E};m=function(r){var c,x,t=r.toString();r=[];for(c=0;c<t.length;c++){x=t.charCodeAt(c);if(x>=256){r.push(x>>>8&255)}r.push(x&255)}return r};E.add=function(I,t){var r,i,C,x,J,c;if(!I){return E}if(!t){I=m(I);t=I.length*8}r=0;i=(8-(t&7))&7;C=o&7;x=t;for(B=31,J=0;B>=0;B--){J+=(z[B]&255)+(x%256);z[B]=J&255;J>>>=8;x=Math.floor(x/256)}while(t>8){c=((I[r]<<i)&255)|((I[r+1]&255)>>>(8-i));if(c<0||c>=256){return"Whirlpool requires a byte array"}A[k++]|=c>>>C;o+=8-C;if(o===512){G();o=k=0;A=[]}A[k]=((c<<(8-C))&255);o+=C;t-=8;r++}if(t>0){c=(I[r]<<i)&255;A[k]|=c>>>C}else{c=0}if(C+t<8){o+=t}else{k++;o+=8-C;t-=8-C;if(o===512){G();o=k=0;A=[]}A[k]=((c<<(8-C))&255);o+=t}return E};E.finalize=function(){var r,c,t,I="",C=[],x=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];A[k]|=128>>>(o&7);k++;if(k>32){while(k<64){A[k++]=0}G();k=0;A=[]}while(k<32){A[k++]=0}A.push.apply(A,z);G();for(r=0,c=0;r<8;r++,c+=8){t=e[r][0];C[c]=t>>>24&255;C[c+1]=t>>>16&255;C[c+2]=t>>>8&255;C[c+3]=t&255;t=e[r][1];C[c+4]=t>>>24&255;C[c+5]=t>>>16&255;C[c+6]=t>>>8&255;C[c+7]=t&255}for(r=0;r<C.length;r++){I+=x[C[r]>>>4];I+=x[C[r]&15]}return I};return E.init().add(a).finalize()}};
